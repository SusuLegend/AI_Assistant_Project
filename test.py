from qdrant_client import QdrantClient
from dotenv import load_dotenv
import chainlit as cl
import openai
import requests
import json
import fitz
from functions import univ_functions

embed_example =[-0.057680029422044754, 0.02163001149892807, 0.044474612921476364, -0.03997804969549179, -0.0401589460670948, -0.007552414666861296, 0.013018062338232994, 0.004835742060095072, 0.011306009255349636, 0.03235457092523575, 0.04248475283384323, -0.024395138025283813, -0.04972060024738312, 0.018658146262168884, 0.042820703238248825, 0.06558777391910553, 0.000616177509073168, 0.032845571637153625, 0.0330781526863575, 0.02330976165831089, -0.009729628451168537, -0.0016635985812172294, -0.0009610108099877834, -0.009949288330972195, 0.02029913291335106, -0.028013061732053757, 0.05245988443493843, 0.012908232398331165, 0.022444045171141624, -0.0038601947017014027, 0.03772976994514465, -0.03566238656640053, -0.020983953028917313, 0.014239111915230751, -0.007959431037306786, 0.004234908148646355, -0.017559848725795746, 0.04767905920743942, 0.02995123527944088, 0.0041315387934446335, 0.00446102861315012, -0.018115457147359848, -0.026023203507065773, 0.05085766315460205, 0.004554706625640392, -0.02341313101351261, 0.052072249352931976, -0.019342968240380287, 0.04685210436582565, 0.0025826157070696354, -0.04297575727105141, 0.012779021635651588, -0.0024469434283673763, -0.00036542638554237783, -0.0076880864799022675, -0.001371257472783327, 0.018050851300358772, 0.020441265776753426, 0.036876972764730453, -0.061091214418411255, 0.04749816283583641, -0.00019068796245846897, 0.026152415201067924, 0.012249253690242767, 0.02200472541153431, 0.013334630988538265, -0.022017646580934525, 0.00974901020526886, 0.0064411950297653675, -0.0041153873316943645, -0.006641473155468702, 0.012901771813631058, 0.02130698226392269, 0.018063772469758987, -0.00909649208188057, 0.016926711425185204, -0.03181188181042671, -0.03225120157003403, -0.007255227770656347, -0.0052298372611403465, -0.017960403114557266, 0.05602612346410751, 0.009807155467569828, 0.007009726017713547, 0.001482702442444861, -0.06088447570800781, -0.06083279103040695, 0.026255784556269646, -0.02443390153348446, 0.0001926059485413134, -0.018309274688363075, -0.0049423412419855595, -0.06134963780641556, 0.0074942694045603275, 0.07230677455663681, -0.014911011792719364, 0.04170948639512062, -0.0313725620508194, -0.02298673242330551, -0.01531156711280346, 0.014872248284518719, -0.0013825634960085154, 0.018490171059966087, -0.012979298830032349, 0.021668775007128716, -0.0014011376770213246, 0.01834803819656372, -0.023891214281320572, -0.04550830274820328, 0.041218481957912445, -0.04183869808912277, -0.008398749865591526, -0.009665023535490036, 0.001100720837712288, 0.02586814947426319, 0.02104855887591839, -0.006473497953265905, -0.057008132338523865, 0.004877735394984484, -0.024653561413288116, -0.027858007699251175, 0.046955473721027374, 0.020570477470755577, -0.014743036590516567, 0.018942411988973618, -0.009658562950789928, -0.0038343523629009724, -0.07225508987903595, 0.01659076102077961, -0.014368323609232903, -0.0032076763454824686, -0.02155248448252678, 0.016732893884181976, -0.014691351912915707, 0.04178701341152191, -0.013069747015833855, -0.014420007355511189, 0.020841822028160095, 0.0009860455757007003, -0.02539006806910038, 0.006085863336920738, 0.041967906057834625, 0.0050780135206878185, 0.053752001374959946, -0.04320833832025528, -0.05923056975007057, -0.021772144362330437, 0.025196250528097153, 0.03677360340952873, -0.0004994833725504577, -0.019588468596339226, 0.008747621439397335, -0.03493880107998848, -0.01248183473944664, 0.05212393403053284, -0.01418742723762989, 0.002038312144577503, 0.0011604811297729611, -0.005216916091740131, -0.03816908970475197, 0.006874053739011288, 0.01907162368297577, -0.004260750487446785, 0.025583885610103607, -0.02373616024851799, 0.011293088085949421, -0.02466648258268833, -0.012132963165640831, -0.05488906055688858, 0.0430532842874527, 0.007184161804616451, -0.04824758693575859, 0.06165974587202072, -0.010026815347373486, 0.02539006806910038, 0.013282946310937405, -0.017094686627388, -0.06853380054235458, -0.0131085105240345, -0.02984786592423916, -0.030313026160001755, 0.004270441364496946, -0.05401042476296425, -0.02080305851995945, 0.03822077438235283, -0.01064056996256113, 0.004864814225584269, 0.003246439853683114, 0.03729045018553734, 0.03897019848227501, 0.009884682483971119, -0.01885196380317211, 0.031139981001615524, 0.053700316697359085, -0.041967906057834625, -0.006269990000873804, 0.015272803604602814, 0.004693609196692705, -0.03439611196517944, 0.010033275932073593, -0.01814129948616028, 0.009303230792284012, -0.03328489139676094, -0.03085571527481079, 0.04904869943857193, -0.0027118271682411432, 0.02661757729947567, -0.027806323021650314, -0.02378784492611885, -0.041967906057834625, 0.03992636501789093, -0.044526297599077225, 0.03576575219631195, -0.0023774923756718636, -0.027806323021650314, 0.024744009599089622, -0.0401589460670948, 0.037988193333148956, 0.060987845063209534, 0.07721681892871857, 0.0053009032271802425, -7.984869444044307e-05, 0.024756930768489838, -0.026281626895070076, 0.0015343870036303997, 0.0025212401524186134, 0.05220146104693413, 0.018464328721165657, 0.03183772414922714, -0.07091129571199417, 0.013489685021340847, -0.01837388053536415, 0.016384022310376167, 0.025583885610103607, 0.004522403702139854, -0.017727823927998543, -0.028452381491661072, -0.009322612546384335, -0.024020425975322723, 0.01269503403455019, 0.005197534337639809, -0.0037535952869802713, 0.04000389203429222, 0.04419034719467163, 0.00724876718595624, 0.009968670085072517, -0.017534006386995316, -0.017534006386995316, 0.00010528721759328619, 0.03519722446799278, -0.025971518829464912, -0.007713928818702698, 0.017663218080997467, -0.04667120799422264, -0.0396420992910862, -0.019717680290341377, -0.027186106890439987, -0.004674227442592382, 0.04589593783020973, 0.006231226492673159, -0.02205641008913517, -0.03499048575758934, 0.004622542764991522, 0.007765613496303558, -0.07365057617425919, -0.05395874008536339, 0.0166682880371809, -0.0025793854147195816, -0.018541855737566948, -0.01659076102077961, 0.0032819730695337057, 0.01327002514153719, 0.0006799757247790694, 0.05235651507973671, 0.005837131291627884, -0.007533032912760973, 0.014316638931632042, 0.02333560399711132, -0.035403963178396225, -0.011273706331849098, -0.0161126796156168, -0.020790137350559235, 0.004609621595591307, 0.032044462859630585, -0.0008681400213390589, 0.035378120839595795, 0.02749621495604515, 0.03139840438961983, -0.09887266904115677, -0.028865857049822807, 0.02095811255276203, -0.02672094665467739, 0.0005055401707068086, -0.002135220682248473, 0.023749081417918205, -0.031243350356817245, -0.012766100466251373, 0.011364154517650604, 0.013050365261733532, 0.026384996250271797, 0.014368323609232903, -0.04669705033302307, 0.05235651507973671, -0.03328489139676094, -0.013670580461621284, -0.0015876868274062872, -0.004845432937145233, -0.016952553763985634, -0.010459674522280693, 0.032793886959552765, -0.046981316059827805, -0.0055141025222837925, 0.0008988277404569089, -0.01324418280273676, -0.047808270901441574, -0.05209809169173241, 0.016887947916984558, -0.0005907390150241554, 0.04388023912906647, -0.0055141025222837925, 0.011764710769057274, -0.03008044697344303, 0.027263633906841278, -0.023451894521713257, -0.031036611646413803, -0.016707051545381546, -0.0070549501106143, 0.0521756187081337, 0.05101271718740463, 0.024601876735687256, 0.003482250962406397, 0.05886877700686455, 0.030157973989844322, 0.007836679928004742, 0.01142876036465168, -0.0037891282700002193, -0.034551165997982025, 0.0564396008849144, -0.01274671871215105, -0.001718513434752822, -0.08228190988302231, -0.06429566442966461, -0.034447796642780304, 0.019213756546378136, 0.0900346040725708, -0.013489685021340847, -0.03297478333115578, 0.02832316979765892, 0.010330462828278542, -0.03385342285037041, 0.003982945811003447, -0.003215752076357603, 0.00280712079256773, 0.027935534715652466, -0.0022418200969696045, -0.024627719074487686, 0.029718654230237007, -0.02378784492611885, 0.026901843026280403, -0.02272830903530121, -0.03183772414922714, 0.01308266818523407, 0.050366658717393875, -0.010931296274065971, 0.04010726138949394, 0.029382703825831413, -0.0749426931142807, -0.0020689996890723705, 0.017701981589198112, -0.08512455970048904, 0.025906912982463837, -0.01927836239337921, 0.01421326957643032, -0.01877443678677082, -0.011396457441151142, -0.02443390153348446, 0.04090837389230728, 0.0333365760743618, 0.03253546729683876, -0.027082739397883415, -0.02325807698071003, 0.012927614152431488, 0.0009997743181884289, -0.04310496896505356, 0.02827148512005806, 0.026979370042681694, 0.003853734117001295, 0.043699342757463455, -0.012559361755847931, 0.023942898958921432, -0.02589399181306362, 0.008366446942090988, 0.021268218755722046, 0.03493880107998848, 0.003030010499060154, -0.015091908164322376, 0.03822077438235283, 0.013877319172024727, 0.024007504805922508, 0.005394581705331802, -0.0669315755367279, -0.02528669871389866, 0.026372075080871582, -0.01087961159646511, 0.0035500871017575264, -0.003340118331834674, -0.036127544939517975, 0.004157381132245064, 0.011512747965753078, 0.009690865874290466, 0.004173532593995333, -0.0686371698975563, 0.04674873501062393, -0.0016401789616793394, -0.007584717124700546, -0.02243112400174141, 0.033775895833969116, 0.014781800098717213, -0.03310399502515793, 0.02909843809902668, 0.005585168953984976, -0.011189719662070274, 0.021772144362330437, -0.050237447023391724, 0.012856547720730305, -0.007255227770656347, 0.037833139300346375, -0.06481251120567322, -0.03349163010716438, -0.012436610646545887, 0.024808615446090698, 0.05390705540776253, -0.004241368733346462, 0.0037342135328799486, -0.050470028072595596, -0.013515527360141277, -0.0012380080297589302, -0.0021432964131236076, 0.0418645404279232, -0.0324837826192379, -0.010692254640161991, 0.04654199630022049, -0.05416547879576683, 0.014032373204827309, -0.019342968240380287, -0.006431504152715206, -0.016422785818576813, 0.010718096978962421, 0.0030671588610857725, 0.013954846188426018, 0.005191073752939701, 0.03064897656440735, -0.01984689198434353, 0.0026504516135901213, -0.016332337632775307, -0.03300062566995621, -0.007617020048201084, -0.010298159904778004, 0.022715387865900993, 0.05581938475370407, 0.025751858949661255, 0.02336144633591175, -0.014846405945718288, 0.055250853300094604, 0.019110387191176414, 0.012520598247647285, -0.00034463140764273703, 0.0033304274547845125, 0.01126724574714899, 0.019588468596339226, 0.016409864649176598, 0.006515491753816605, 0.028917541727423668, -0.01619020663201809, -0.000531382451299578, 0.0060503301210701466, 0.026436680927872658, -0.04300159960985184, -0.04217464476823807, 0.00746196648105979, 0.03424105793237686, -0.0031123829539865255, 0.022237306460738182, 0.05680139362812042, -0.01145460270345211, 0.007171240635216236, 0.01706884428858757, -0.03571407124400139, 0.012546440586447716, -0.0059340400621294975, -0.025299619883298874, -0.0001796847936930135, 0.04762737452983856, -0.013748107478022575, -0.038634251803159714, 0.021423272788524628, -0.039357833564281464, -0.001318765222094953, 0.03439611196517944, -0.008159708231687546, 0.06915401667356491, -0.05385537073016167, -0.03090739995241165, 0.03920277953147888, 0.01704300194978714, 0.0396420992910862, -0.02749621495604515, -0.022172700613737106, -0.020286211743950844, 0.02731531858444214, 0.003323966870084405, 0.004829281475394964, 0.018063772469758987, -0.011557972058653831, -0.018050851300358772, 0.02090642787516117, -0.007907746359705925, 0.005875894799828529, -0.012010212987661362, -0.017249740660190582, -0.016952553763985634, 0.0026294547133147717, -0.03411184623837471, -0.0022192082833498716, -0.020441265776753426, -0.056284546852111816, -0.013282946310937405, -0.04310496896505356, -0.005930809769779444, -0.04333755001425743, 0.007003265433013439, -0.014019452035427094, -0.02648836560547352, 0.038763463497161865, -0.03597249090671539, -0.044526297599077225, 0.019756443798542023, 0.019407574087381363, -0.0422004871070385, 0.024769851937890053, 0.033724211156368256, 0.024950748309493065, 0.013463842682540417, 0.0028975687455385923, -0.028736647218465805, 0.007662244141101837, -0.002500243252143264, -0.006479958537966013, -0.03506801277399063, 0.0007784995250403881, -0.0052007646299898624, -0.05494074523448944, 0.010427371598780155, -0.0023597257677465677, 0.01137707568705082, 0.05390705540776253, -0.0186710674315691, -0.02075137384235859, -0.02075137384235859, -0.032742202281951904, 0.02989955060184002, -0.01087961159646511, 0.011797013692557812, 0.02325807698071003, -0.020841822028160095, 0.005898506846278906, 0.0330781526863575, -0.0598507858812809, 0.012759639881551266, 0.019833970814943314, 0.0007437739404849708, 0.04481056332588196, -0.02218562178313732, 0.048635222017765045, -0.01691379025578499, -0.021358666941523552, -0.04147690534591675, -0.03816908970475197, 0.01106696855276823, -0.02343897335231304, -0.011047586798667908, 0.00117663259152323, -0.021565405651926994, -0.018503092229366302, 0.009516430087387562, 0.010311081074178219, 0.047058843076229095, 0.05401042476296425, -0.007617020048201084, 0.004031400196254253, 0.037884823977947235, -0.00852150097489357, 0.015802571550011635, -0.03855672478675842, 0.014252033084630966, 0.00870885793119669, 0.035429805517196655, -0.020441265776753426, -0.00870885793119669, 0.030597291886806488, 0.027625426650047302, -0.01452337671071291, -0.01613852195441723, -0.03834998607635498, 0.0008947899332270026, 0.018244668841362, 0.016551997512578964, 0.009329073131084442, 0.035429805517196655, 0.02659173496067524, -0.023917056620121002, -0.002589076291769743, 0.004638694226741791, -0.015531226992607117, 0.007171240635216236, 0.03579159453511238, -0.043673500418663025, -0.01243015006184578, 0.008876833133399487, -0.002742514945566654, -0.00417999317869544, 0.0150273023173213, 0.04514651000499725, 0.003320736577734351, 0.017378952354192734, 0.01799916662275791, -0.010944217443466187, -0.013941925019025803, -0.011189719662070274, -0.026010282337665558, -0.00991052482277155, 0.03592080622911453, 0.023270998150110245, -0.05824856087565422, -0.008657173253595829, -0.023749081417918205, -0.01137707568705082, -0.0015020841965451837, -0.03576575219631195, 0.0007720389403402805, 0.01942049339413643, 0.01704300194978714, 0.024343453347682953, -0.03434442728757858, 0.06331365555524826, 0.029486073181033134, 0.020570477470755577, -0.0016224123537540436, -0.03995220735669136, -0.026126572862267494, -0.049539703875780106, -0.020066551864147186, 4.726820407086052e-05, -0.005084474105387926, 0.020583398640155792, -0.007268148940056562, 0.012662731111049652, -0.029460230842232704, 0.0047937482595443726, -0.012397847138345242, -0.027858007699251175, -0.004742063581943512, 0.017508164048194885, 0.01329586748033762, 0.010026815347373486, 0.014148663729429245, -0.0017201285809278488, -0.0012460837606340647, 0.02728947624564171, 0.019717680290341377, -0.03555901721119881, 0.0037503649946302176, -0.0019575548358261585, -0.017689060419797897, -0.003886037040501833, -0.015673359856009483, 0.007003265433013439, -0.0266434196382761, -0.027237791568040848, 0.021617090329527855, -0.012042514979839325, -0.003924800548702478, -0.03473206236958504, 0.014032373204827309, -0.02368447557091713, 0.007377978879958391, -0.0028943384531885386, 0.03320736438035965, 0.004622542764991522, -0.009161097928881645, 0.020092394202947617, 0.003479020670056343, 0.011312469840049744, -0.018541855737566948, 0.0011580584105104208, 0.007991733960807323, -0.005417193751782179, 0.019187914207577705, -0.022146858274936676, -0.12073526531457901, 0.026410838589072227, -0.002526085590943694, -0.012682112865149975, -0.025532200932502747, -0.00960041768848896, 0.0009569729445502162, -0.05176214128732681, -0.030364710837602615, 0.05142619088292122, -0.0104661351069808, -0.0026133034843951464, -0.0017088225577026606, -0.049513861536979675, 0.0020302364137023687, 0.00917401909828186, 0.018877806141972542, -0.0027489755302667618, 0.01626773364841938, 0.0025696945376694202, -0.018360959365963936, -0.019291283562779427, 0.03437026962637901, -0.02907259576022625, -0.005036019720137119, -0.0401589460670948, 0.01674581505358219, -0.023426052182912827, 0.018025008961558342, -0.01022709347307682, -0.024950748309493065, 0.006628551986068487, -0.016448628157377243, -0.010446753352880478, -0.015066065825521946, 0.0225086510181427, -0.019743522629141808, 0.008288919925689697, 0.00015131883264984936, 0.0037212923634797335, -0.006835290230810642, 0.02568725310266018, -0.01922667771577835, -0.007772074081003666, 0.009697326458990574, -0.0009997743181884289, 0.003007398685440421, -0.009632720611989498, 0.024808615446090698, 0.016022231429815292, -0.054527267813682556, -0.011441681534051895, 0.010491976514458656, 0.005339666735380888, 0.016629524528980255, -0.005556096322834492, -0.026217021048069, 0.012804863974452019, 0.006247377954423428, 0.0005467263399623334, -0.01376102864742279, 0.029486073181033134, 0.02677263133227825, 0.029666969552636147, 0.027367003262043, 0.014458770863711834, -0.03974546864628792, 0.01629357598721981, -0.012830705381929874, 0.014652588404715061, -0.020195763558149338, -0.028865857049822807, -0.006244147662073374, -0.055405907332897186, 0.012249253690242767, 0.03336241841316223, 0.04261396452784538, 0.004541785456240177, -0.05308010056614876, -0.01719805598258972, 0.029796181246638298, 0.03558485954999924, -0.011209101416170597, 0.02010531537234783, -0.020790137350559235, 0.0005273445858620107, -0.024330532178282738, 0.03754887357354164, -0.021991804242134094, -0.01056304294615984, -0.025377146899700165, 0.014613824896514416, 0.029253492131829262, 0.01303098350763321, 0.017676139250397682, 0.02413671463727951, -0.020363738760352135, 0.00010387396469013765, -0.030313026160001755, -0.023270998150110245, 0.04235554113984108, 0.0025034735444933176, 0.05127113685011864, 0.00046596911852248013, 0.009619799442589283, 0.047989167273044586, 0.012863008305430412, 0.009858840145170689, 0.04571504145860672, -0.026876000687479973, -0.020660925656557083, 0.03928030654788017, -0.004913268610835075, 0.011079889722168446, 0.020286211743950844, 0.00453532487154007, 0.0023791075218468904, 0.003556547686457634, 0.02496366947889328, 0.016875026747584343, -0.0166682880371809, 0.02152664214372635, -0.006198923569172621, 0.019342968240380287, 0.02589399181306362, 0.017934560775756836, -0.007998194545507431, 0.04685210436582565, -0.006176311522722244, -0.00751365115866065, 0.006576867308467627, -0.002761896699666977, 0.04481056332588196, -0.01536325179040432, -0.011797013692557812, 0.036101702600717545, -0.022702466696500778, -0.0068159084767103195, -0.01066641230136156, -0.004832511767745018, 0.014394165016710758, 0.030157973989844322, 0.0021432964131236076, 0.015298645943403244, -0.0017669678200036287, -0.001951094251126051, -0.0396420992910862, 0.0014697812730446458, 0.0009497047867625952, -0.026049045845866203, 0.029589442536234856, -0.03416353091597557, -0.02040250226855278, -0.005959882400929928, 0.0019591699820011854, 0.015376172959804535, 0.05323515459895134, 0.00786898285150528, -0.006667315494269133, 0.028013061732053757, -0.009593957103788853, -0.04168364405632019, -0.02253449149429798, 0.02371031790971756, -0.055354222655296326, 0.018386801704764366, -0.036050017923116684, -0.02360694855451584, -0.034499481320381165, -0.01449753437191248, -0.012074817903339863, 0.0023500348906964064, -0.008179089985787868, 0.01576380804181099, 0.007830219343304634, 0.020712610334157944, -0.020144078880548477, -0.036024175584316254, 0.05013407766819, -0.02656589262187481, -0.05830024555325508, -0.009102952666580677, 0.00023035994672682136, 0.026979370042681694, 0.002571309683844447, 0.021462036296725273, -0.017701981589198112, 0.02912428043782711, 0.03501632809638977, -0.0007962661329656839, 0.02899506874382496, 0.011086350306868553, 0.022263148799538612, -0.006809447892010212, -0.005103855859488249, -0.0038666552864015102, 0.01492393296211958, -0.004147690255194902, -0.015518305823206902, 0.030235501006245613, 0.0027392846532166004, 0.00035210142959840596, 0.00073771714232862, 0.027651268988847733, 0.02343897335231304, 0.010511358268558979, -0.03312983736395836, -0.015996389091014862, 0.033620841801166534, 0.010575964115560055, -0.016358179971575737, -0.012598125264048576, 0.0034854812547564507, -0.0044351862743496895, 0.01882612146437168, 0.002027006121352315, -0.00036784910480491817, -0.019381731748580933, 0.02904675342142582, -0.03382758051156998, 0.0005410733283497393, -0.021268218755722046, 0.013308788649737835, -0.010621188208460808, -0.02997707761824131, -0.008049879223108292, 0.008250156417489052, 0.010808545164763927, 0.019769364967942238, 0.022547412663698196, 0.03225120157003403, 0.004977874457836151, 0.022999653592705727, 0.04070163518190384, 0.004296283703297377, 0.021113164722919464, 0.03592080622911453, 0.01492393296211958, -0.009710246697068214, 0.0156862810254097, 0.010491976514458656, 0.013257103972136974, 0.015828413888812065, -0.02296089008450508, -0.00499402591958642, -0.002996092662215233, 0.0024227164685726166, 0.033698368817567825, 0.029279334470629692, 0.013528448529541492, -0.00561424158513546, 0.0053170546889305115, -0.008941438049077988, 0.019536783918738365, -0.03739381954073906, -0.004593470133841038, 0.012837165966629982, -0.024601876735687256, -0.020415423437952995, 0.029253492131829262, -0.023671554401516914, -0.005368739366531372, 0.039383675903081894, -0.011099271476268768, 0.02112608589231968, -0.04189038276672363, -0.002963789738714695, 0.04385439679026604, 0.0110411262139678, -0.04543077573180199, -0.020066551864147186, -0.01571212336421013, -0.003556547686457634, 0.018438486382365227, -0.004112157039344311, 0.0059954156167805195, -0.016461549326777458, -0.006227996200323105, 0.01786995492875576, -0.03346578776836395, 0.0017605072353035212, 0.009865300729870796, 0.01109281089156866, 0.028891699388623238, 0.01864522509276867, -0.02218562178313732, 0.004079854115843773, 0.009606878273189068, -0.007093713618814945, 0.02288336306810379, 0.025209171697497368, -0.007293991278856993, -0.007022647187113762, 0.019381731748580933, -0.027806323021650314, 0.02997707761824131, -0.004438416566699743, -0.04067579284310341, -0.021345745772123337, -0.02175922319293022, -0.007797916419804096, 0.008889754302799702, 0.012313859537243843, 0.018477249890565872, -0.006605939939618111, -0.012023134157061577, -0.019485099241137505, 0.0032674367539584637, 0.033801738172769547, -0.01145460270345211, 0.007545954082161188, -0.013618895784020424, -0.007972352206707, -0.07949093729257584, -0.016203127801418304, 0.021746302023530006, -0.031114138662815094, -0.0007833449635654688, -0.032690517604351044, -0.007416742388159037, -0.05093519017100334, 0.034525323659181595, -0.0024243316147476435, 0.008889754302799702, -0.017779508605599403, -0.024007504805922508, -0.029460230842232704, 0.003306200262159109, -0.03341410309076309, 0.007210003677755594, -0.00026488365256227553, -0.0050941649824380875, -0.018180062994360924, -0.04566335678100586, -0.005249218549579382, -0.01122848317027092, 0.00873470026999712, -0.030287185683846474, 0.0008964050794020295, -0.050237447023391724, 0.004955262411385775, 0.009135255590081215, -0.005029559135437012, -0.03974546864628792, 0.05793845281004906, -0.01734018884599209, -0.013450921513140202, -0.00852150097489357, 0.02318054996430874, 0.027935534715652466, 0.009677944704890251, 0.03729045018553734, -0.013864398002624512, -0.02757374197244644, -0.024291768670082092, 0.016771657392382622, -0.03088155761361122, -0.010634109377861023, -0.0026488364674150944, -0.01576380804181099, -0.015996389091014862, 0.011784092523157597, 0.017210977151989937, -0.0404948964715004, -0.023929977789521217, -0.0074490453116595745, -0.006176311522722244, 0.02827148512005806, 0.011370615102350712, -0.004709760658442974, -0.010453213937580585, 0.03181188181042671, 0.007332754787057638, 0.01651323400437832, -0.0006387895555235445, 0.014678430743515491, -0.02533838339149952, 0.017534006386995316, -0.009180479682981968, 0.02837485447525978, 0.029486073181033134, 0.01781827211380005, 0.025480516254901886, 0.018050851300358772, -0.0413476936519146, 0.015143592841923237, 0.03524890914559364, 0.006854671984910965, 0.0030203196220099926, -0.017314346507191658, -0.022017646580934525, -0.01142876036465168, -0.005685307551175356, -0.00393449142575264, -0.006583327893167734, -0.020893506705760956, 0.040314000099897385, 0.0015481157461181283, -0.01754692755639553, 0.005210455507040024, 0.0324837826192379, 0.012863008305430412, -0.016435706987977028, 0.03651518002152443, -0.01619020663201809, 0.028452381491661072, -0.0212294552475214, -0.014820563606917858, 0.022276069968938828, 0.004244599025696516, 0.011577353812754154, -0.014665509574115276, -0.02739284560084343, -0.002789354184642434, 0.017986245453357697, -0.04351844638586044, 0.009206322021782398, 0.01208127848803997, 0.02896922640502453, 0.010873151011765003, 0.02626870572566986, 0.006131087429821491, -0.03070066124200821, -0.013425079174339771, 0.020996874198317528, 0.01408405788242817, -0.010052657686173916, 0.032897256314754486, -0.002511549275368452, 0.0022208234295248985, -0.016280654817819595, -0.00794650986790657, 0.01025293581187725, 0.0070743318647146225, 0.005339666735380888, -0.0339309498667717, -0.03646349534392357, -0.01500145997852087, 0.010705175809562206, 0.01452337671071291, -0.0017572769429534674, -0.024873221293091774, -0.010711636394262314, 0.00626675970852375, 0.03902188315987587, -0.020092394202947617, 0.0024727857671678066, 0.016810420900583267, 0.06951580941677094, 0.019678916782140732, 0.028452381491661072, -0.01797332428395748, -0.0027344392146915197, 0.0003953065606765449, -0.06434734910726547, -0.020492950454354286, -0.002589076291769743, 0.036050017923116684, 0.03382758051156998, -0.008502119220793247, -0.020557556301355362, -0.03718708083033562, -0.008670094422996044, 0.003776207333430648, -0.006538103800266981, -0.00043770408956333995, 0.003973254933953285, -0.03400847688317299, -0.0010328846983611584, 0.015660438686609268, 0.009891143068671227, 0.005866203922778368, 0.036127544939517975, 0.0029686351772397757, 0.018554776906967163, 0.009206322021782398, 0.012707955203950405, 0.03408600389957428, 0.006551024969667196, 0.0161126796156168, 0.010181869380176067, 0.026384996250271797, -0.03984883800148964, 0.02539006806910038, -0.028840014711022377, 0.009232164360582829, 0.010317541658878326, -0.01449753437191248, -0.0008023228729143739, 0.0029217959381639957, 0.014781800098717213, 0.009115873835980892, 0.0156862810254097, 0.009006043896079063, 0.011034665629267693, -0.002236974658444524, -0.03439611196517944, -0.019665995612740517, -0.04473303630948067, -0.022237306460738182, 0.023619869723916054, -0.00689343549311161, -0.01651323400437832, 0.025196250528097153, -0.043725185096263885, -0.031010769307613373, 0.010220632888376713, 0.019342968240380287, -0.01264334935694933, 0.005969573277980089, -0.01505314465612173, 0.03473206236958504, 0.008980201557278633, -0.0076105594635009766, -0.001607068465091288, -0.04964307323098183, 0.012753179296851158, 0.016758736222982407, 0.008624870330095291, 0.018386801704764366, -0.04680041968822479, 0.014277875423431396, 0.03739381954073906, 0.014006530866026878, 0.04052073881030083, -0.005946961231529713, 0.018955333158373833, 0.004396422766149044, -0.015854256227612495, -0.012888850644230843, -0.01221695076674223, -0.003446717746555805, 0.028555750846862793, -0.010382147505879402, 0.016332337632775307, -0.013089128769934177, 0.023348525166511536, -0.02290920540690422, -0.02245696634054184, -0.0035597779788076878, 0.010007433593273163, -0.02215977944433689, 0.006399201694875956, 0.01538909412920475, 0.007339215371757746, -0.002574539976194501, 0.014290796592831612, 0.007171240635216236, 0.012339701876044273, -0.012617507018148899, -0.0110411262139678, 0.016409864649176598, -0.006008336786180735, -0.01329586748033762, -0.029537757858633995, -0.0404948964715004, 0.03488711640238762, -0.025777701288461685, 0.02536422573029995, 0.04212296009063721, 0.025235014036297798, -0.02573893778026104, 0.03902188315987587, -0.03884098678827286, -0.04212296009063721, -0.024653561413288116, -0.0254934374243021, -0.013282946310937405, 0.002574539976194501, 0.01693963259458542, 0.01452337671071291, -0.036256756633520126, 0.004477179609239101, -0.014096979051828384, 0.011222022585570812, -0.04897117242217064, 0.030493922531604767, 0.021139007061719894, -0.017753666266798973, 0.026217021048069, 0.02669510431587696, 0.019937340170145035, 0.03173435479402542, 0.018735673278570175, -0.05576770007610321, 0.018360959365963936, 0.007061410695314407, 0.027858007699251175, 0.016887947916984558, 0.017585691064596176, 0.028788330033421516, 0.006583327893167734, 0.004431955981999636, -0.001637756242416799, -0.02606196701526642, -0.02466648258268833, 0.03636012598872185, 0.03300062566995621, -0.019808128476142883, -0.0006723037804476917, -0.03134671971201897, 0.037858981639146805, -0.012830705381929874, -0.0027344392146915197, -0.015957625582814217, 0.028917541727423668, -0.008747621439397335, 0.02336144633591175, 0.014277875423431396, -0.02648836560547352, -0.029460230842232704, -0.005879125092178583, 0.0116161173209548, -3.4574182791402563e-05, -0.04669705033302307, 0.01142876036465168, -0.0010789163643494248, 0.004383501596748829, -0.018968254327774048, -0.005623932462185621, 0.05716318637132645, 0.00031010768725536764, 0.014252033084630966, -0.04550830274820328, -0.01995026133954525, -0.018335117027163506, -0.031217508018016815, 0.030157973989844322, 0.0035920809023082256, -0.010911914519965649, 0.0266434196382761, 0.008314762264490128, -0.011868080124258995, 0.011732407845556736, -0.025144565850496292, 0.00014617055421695113, 0.011273706331849098, 0.0021271449513733387, 0.04429371654987335, -0.010194790549576283, 0.028943384066224098, 0.007184161804616451, -0.010349844582378864, 0.05003070831298828, 0.02677263133227825, -0.0015360021498054266, 0.004422265104949474, -0.022844599559903145, 0.0017088225577026606, 0.04235554113984108, -0.04261396452784538, 0.005694998428225517, 0.01541493646800518, 0.0146009037271142, -0.0025486976373940706, 0.01739187352359295, 0.00028810134972445667, 0.024201320484280586, 0.018541855737566948, -0.029666969552636147, 0.010498437099158764, 0.0035145538859069347, -0.004137999378144741, -0.01741771586239338, 0.008870372548699379, -0.0026359152980148792, 0.01621604897081852, -0.017482321709394455, 0.029382703825831413, 0.021810907870531082, -0.01779242977499962, -0.004409343935549259, -0.01190684363245964, 0.007397360634058714, 0.019330047070980072, -0.024795694276690483, 0.010569503530859947, 0.012255714274942875, -0.0016417941078543663, 0.0046419245190918446, -0.0027408997993916273, -0.0313725620508194, 0.025325462222099304, -0.0036760682705789804, -0.031966935843229294, 0.014665509574115276, 0.01036276575177908, -0.0049714138731360435, 0.0006618053303100169, 0.012908232398331165, 0.013224801048636436, -0.0009844304295256734, 0.01962723210453987, 0.035403963178396225, 0.011422299779951572, 0.011797013692557812, 0.009755470789968967, -0.030390553176403046, 0.006899896077811718, 0.006615630816668272, -0.000401767116272822, 0.02666926197707653, -0.0292018074542284, 0.05385537073016167, -0.0048971171490848064, 0.003057467984035611, 0.014484613202512264, 0.0205058716237545, 0.012003752402961254, -0.012346162460744381, 0.010272317565977573, 0.007972352206707, 0.021113164722919464, -0.021746302023530006, 0.005262139718979597, 0.013748107478022575, -0.02752205729484558, -0.007048489525914192, -0.006011567078530788, -0.034525323659181595, -0.0031915251165628433, -0.03814324736595154, -0.024007504805922508, 0.011099271476268768, 0.040314000099897385, 0.03925446420907974, 0.0350421704351902, -0.00889621488749981, 0.009942827746272087, 0.020596319809556007, -0.033646684139966965, -0.00331104570068419, 0.0350421704351902, 0.02240528166294098, 0.033698368817567825, 0.011990831233561039, 0.056181177496910095, 0.03250962495803833, 0.012417228892445564, 0.00993636716157198, 0.0347837470471859, 0.0026439910288900137, 0.06145300716161728, 0.014394165016710758, -0.00015041031292639673, 0.04809253662824631, -0.020014867186546326, -0.00026851773145608604, -0.008967280387878418, -0.013528448529541492, -0.008398749865591526, -0.025079960003495216, 0.021423272788524628, 0.0008495658403262496, 0.04413866251707077, -0.010840848088264465, 0.01087961159646511, 0.012391386553645134, 0.024291768670082092, 0.010395068675279617, 0.006244147662073374, -0.015285724774003029, 0.0035662385635077953, 0.01085376925766468, -0.007087253034114838, 0.007558875251561403, 0.02408502995967865, 0.04473303630948067, 0.0015884944004938006, 0.016810420900583267, 0.0004550668818410486, -0.0015699202194809914, 0.009929906576871872, -0.012623967602849007, -0.011383536271750927, -0.018012087792158127, -0.012636888772249222, -0.012701494619250298, 0.01872275210916996, 0.0017378951888531446, -0.002652066759765148, -0.00708079244941473, -0.015699202194809914, -0.00980069488286972, -0.027134424075484276, 0.047989167273044586, -0.01370934396982193, -0.02243112400174141, -0.028684962540864944, 5.880134631297551e-05, -0.002044772496446967, -0.03406016156077385, -0.03139840438961983, 0.007558875251561403, 0.004690378904342651, -0.009458284825086594, 0.0350421704351902, 0.009813616052269936, -0.024317611008882523, 0.018231747671961784, 0.015376172959804535, 0.019459256902337074, -0.0007046066457405686, -0.015246961265802383, -0.001544077880680561, -0.01954970508813858, -0.002805505646392703, 0.009729628451168537, 0.008159708231687546, 0.03744550421833992, -0.012578743509948254, 0.024847378954291344, -0.021746302023530006, -0.01832219585776329, -0.009929906576871872, 0.016358179971575737, -0.01749524287879467, -0.014071136713027954, -0.001497238758020103, -0.0257906224578619, 0.00748780881986022, -0.017934560775756836, -0.006660854909569025, 0.02288336306810379, -0.03331073373556137, 0.01531156711280346, 0.00784314051270485, -0.035378120839595795, 0.032044462859630585, -0.0464644692838192, 0.03473206236958504, 0.03961625695228577, 0.008476276881992817, -0.024950748309493065, -0.03486127406358719, 0.04230385646224022, -0.003911879379302263]

def query_qdrant(query, collection_name, vector_name='content', top_k=10):
    query_results = client.search(
        collection_name=collection_name,
        query_vector=(vector_name, query),
        limit=top_k, 
        query_filter=None,
        score_threshold = 0.36,
    )
    return query_results

def get_top_search(query, title):
    query_results = query_qdrant(query, collection_name, 'content')
    list_str = ""
    for article in query_results:
        if article.payload["title"] in title:
            continue
        title.append(article.payload["title"])
        list_str += f'{article.payload["title"]}, this movie review: {article.payload["content"]}\n'
    return list_str, title

def get_element(search_result):
    pass
    # element = []
    # for result in search_result:
    #     if(result.payload['type']=='pdf'):
            

def extract_relevant_pages(results):
    
    relevant_pages = []

    for result in results:
        if(result.payload['type']=='pdf'):
            relevant_pages.append([result.payload['file_name'],result.payload['start_page'],result.payload['end_page']])
            print(result.payload['title'],result.payload['start_page'])
    print(len(relevant_pages))
    #print(relevant_pages)
    # Create a new PDF with relevant pages
    if relevant_pages:
        new_pdf_path = '../Project_AI_assistant/pdf/relevant_pages.pdf'
        new_doc = fitz.open()
        for filename, start, end in relevant_pages:
            pdf_path = f'../Project_AI_assistant/pdf/{filename}.pdf' 
            doc = fitz.open(pdf_path)
            new_doc.insert_pdf(doc, from_page=start, to_page=end)
            print(new_doc)
        new_doc.save(new_pdf_path)
        new_doc.close()
        return new_pdf_path
    else:
        return None

def get_next_index():
    response = client.scroll(
        collection_name=collection_name,
        limit=1,
        with_payload=False,
    )
    # if response and response.points:
    #     return response.points[0].id + 1
    return response

client = QdrantClient(host="localhost", port=6333)
collection_name = "university_collection"
# test = query_qdrant(embed_example, 'university_collection', 'content')
# new_pdf_path = extract_relevant_pages(test)

print(get_next_index())

